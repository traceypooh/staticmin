#!/bin/sh -eux

for FI in $(find lib/ -name '*.js'); do
  # eg: ... from 'https://esm.sh/request-promise@^4.2.2'
  perl -i -pe "s=from 'https://esm.sh/([^@/]+)@[^']+=from '\$1=" $FI
  perl -i -pe "s=from 'https://esm.sh/(\@octokit/[^@/]+)@[^']+=from '\$1=" $FI
done

# node_modules is ~60MB
[ -e node_modules/markdown-table ] || npm i
